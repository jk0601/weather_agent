# 날씨 AI 에이전트

OpenAI Agents API와 기상청 단기예보 API를 사용한 간단한 날씨 정보 제공 에이전트입니다.

## 기능

- 사용자가 도시 이름이나 서울 구 이름을 입력하면 해당 지역의 현재 날씨 정보를 제공합니다.
- OpenAI의 GPT-4o 모델을 사용하여 자연어로 대화합니다.
- 기상청 단기예보 API를 통해 실시간 날씨 데이터를 가져옵니다.
- 현재 날씨 상태와 시간별 예보 정보를 제공합니다.
- Streamlit을 이용한 웹 인터페이스를 제공합니다.

## 설치 방법

1. 저장소를 클론합니다.
```
git clone <repository-url>
cd weather
```

2. 필요한 패키지를 설치합니다.
```
pip install -r requirements.txt
```

3. `.env` 파일에 API 키를 설정합니다.
```
OPENAI_API_KEY=your_openai_api_key_here
WEATHER_API_KEY=your_weather_api_key_here
```

### API 키 얻는 방법

#### OpenAI API 키
1. [OpenAI 플랫폼](https://platform.openai.com/)에 로그인합니다.
2. 우측 상단의 프로필 아이콘을 클릭하고 "View API keys"를 선택합니다.
3. "Create new secret key" 버튼을 클릭하여 새 API 키를 생성합니다.
4. 생성된 키를 `.env` 파일의 `OPENAI_API_KEY` 값으로 설정합니다.

#### 기상청 API 키
1. [공공데이터포털](https://www.data.go.kr/)에 가입합니다.
2. [기상청 단기예보 API](https://www.data.go.kr/tcs/dss/selectApiDataDetailView.do?publicDataPk=15084084) 페이지로 이동합니다.
3. "활용신청" 버튼을 클릭하여 API 사용 신청을 합니다.
4. 승인 후 "마이페이지 > 오픈API > 인증키 발급현황"에서 인증키를 확인합니다.
5. 발급받은 인증키(일반 인증키)를 `.env` 파일의 `WEATHER_API_KEY` 값으로 설정합니다.

## 사용 방법

### 콘솔 애플리케이션으로 실행

1. 다음 명령어로 콘솔 애플리케이션을 실행합니다.
```
python weather_agent.py
```

2. 프롬프트가 나타나면 원하는 지역의 날씨에 대해 질문합니다.
   예: "서울의 날씨는 어때요?", "구로구의 현재 기온은 몇 도인가요?"

3. 종료하려면 `exit`를 입력합니다.

### 웹 애플리케이션으로 실행 (Streamlit)

1. 다음 명령어로 Streamlit 웹 애플리케이션을 실행합니다.
```
streamlit run app.py
```

2. 웹 브라우저가 자동으로 열리고 앱이 실행됩니다.
   (기본적으로 http://localhost:8501 에서 실행됩니다)

3. 채팅 인터페이스에서 원하는 지역의 날씨에 대해 질문합니다.

4. 대화 기록은 세션 동안 유지됩니다.

### 가족과 공유하기

1. 로컬 네트워크에서 공유:
   - Streamlit 앱을 실행할 때 다음 명령어를 사용하여 네트워크 내에서 접근 가능하게 합니다.
   ```
   streamlit run app.py --server.headless=true --server.enableCORS=false
   ```
   - 실행 후 표시되는 네트워크 URL을 가족들에게 공유합니다.

2. 클라우드 배포:
   - [Streamlit Cloud](https://streamlit.io/cloud)를 사용하여 무료로 배포할 수 있습니다.
   - GitHub에 코드를 업로드한 후 Streamlit Cloud에서 배포하면 인터넷을 통해 누구나 접근할 수 있습니다.

## 지원하는 지역

현재 다음 지역의 날씨 정보를 제공합니다:
- **광역시/도**: 서울, 부산, 인천, 대구, 광주, 대전, 울산, 세종, 경기, 강원, 충북, 충남, 전북, 전남, 경북, 경남, 제주
- **서울 구 단위**: 구로구, 은평구, 양천구

## 예시 대화

```
질문: 서울의 날씨는 어때요?

도우미: 서울의 현재 날씨는 맑음이고, 기온은 23.5°C입니다. 강수 확률은 10%이며, 습도는 65%입니다. 풍속은 2.1m/s입니다.

앞으로의 시간별 예보를 보면:
- 15시: 기온 24.2°C, 맑음
- 16시: 기온 24.0°C, 맑음
- 17시: 기온 23.5°C, 구름많음

질문: 구로구의 날씨는 어때요?

도우미: 구로구의 현재 날씨는 구름많음이고, 기온은 22.8°C입니다. 강수 확률은 20%이며, 습도는 68%입니다. 풍속은 1.8m/s입니다.

앞으로의 시간별 예보를 보면:
- 15시: 기온 23.5°C, 구름많음
- 16시: 기온 23.0°C, 구름많음
- 17시: 기온 22.5°C, 흐림
```

## 문제 해결

- **"API 키가 유효하지 않습니다"** 오류가 발생하는 경우:
  - `.env` 파일에 올바른 API 키가 설정되어 있는지 확인하세요.
  - 기상청 API 키는 공공데이터포털에서 발급받은 일반 인증키를 사용해야 합니다.
  - 공공데이터포털에서 제공하는 인증키를 그대로 복사하여 붙여넣으세요. 인코딩/디코딩 과정이 필요하지 않습니다.

- **"도시를 찾을 수 없습니다"** 오류가 발생하는 경우:
  - 지원하는 지역 목록에 있는 도시 이름을 입력했는지 확인하세요.
  - 현재는 17개 광역시/도와 3개의 서울 구 단위로만 날씨 정보를 제공합니다.

- **기상청 API 연결 문제**:
  - 공공데이터포털에서 제공하는 두 가지 인증키(일반 인증키, 디코딩 인증키) 중 일반 인증키를 사용하세요.
  - 인증키가 활성화되어 있는지 확인하세요. 신청 후 승인까지 시간이 걸릴 수 있습니다.
  - 일일 호출 한도를 초과하지 않았는지 확인하세요.

- **Streamlit 앱 실행 문제**:
  - Streamlit이 올바르게 설치되었는지 확인하세요: `pip install streamlit`
  - 포트 충돌이 발생하는 경우 다른 포트를 지정하여 실행하세요: `streamlit run app.py --server.port=8502`

## 프로젝트 구조

- `weather_agent.py`: 콘솔 애플리케이션 메인 코드
- `app.py`: Streamlit 웹 애플리케이션 코드
- `weather_tool.py`: 날씨 정보를 가져오는 도구
- `requirements.txt`: 필요한 패키지 목록
- `.env`: API 키 설정 파일

## 추가 지역 등록 방법

더 많은 지역을 추가하려면 `weather_tool.py` 파일의 `location_codes` 딕셔너리에 해당 지역의 격자 좌표(nx, ny)를 추가하세요. 기상청 API는 격자 좌표를 사용하여 날씨 정보를 제공합니다.

예시:
```python
location_codes = {
    # 기존 코드...
    
    # 새로운 지역 추가
    "강남구": {"nx": 61, "ny": 126},
    "송파구": {"nx": 62, "ny": 126}
}
```

격자 좌표는 [기상청 격자 좌표 변환](https://www.data.go.kr/tcs/dss/selectFileDown.do?publicDataPk=15084084&publicDataDetailPk=15084085&file_name=GRID_WEST_1_00_PLUS.zip)에서 확인할 수 있습니다. 